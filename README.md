# TotoroNest Control

ESP32 智能温控系统，用于控制龙猫窝内温湿度，具备温度采集、制冷控制、OLED 显示、蓝牙采集、MQTT 上传、HTTP/Web 控制等功能。

---

## 项目用途

- 实时采集窝内与外界温湿度数据（DS18B20 + 米家蓝牙温湿度计）
- 控制 TEC 半导体制冷模块及风扇，实现自动温控
- OLED 屏幕显示所有状态、图标和传感器数据
- 通过 Web 页面或 MQTT 实时查看和控制系统状态

---

## 使用方法

1. 准备 PlatformIO 环境
2. 导入项目并更新平台、工具链
3. `include/secrets_template.h` 复制为 `secrets.h`，配置 WiFi/MQTT 密钥
4. 编译并上传文件系统
5. 编译并上传

---

## 使用的器件

| 器件               | 描述              |
|------------------|-----------------|
| ESP32 DevKit     | 主控芯片            |
| DS18B20 ×3       | 数字温度传感器         |
| OLED 0.96"       | SSD1306 I2C 显示屏 |
| LR7843 MOSFET ×2 | 控制 TEC 和风扇电源    |
| TEC1-12708       | 半导体制冷片          |
| 小米米家蓝牙温湿度计2      | BLE 蓝牙温湿度传感器    |

---

## 电气连接说明

| 功能       | ESP32 GPIO                 |
|----------|----------------------------|
| DS18B20  | GPIO32 / 33 / 34 （分3个总线）   |
| TEC 开关控制 | GPIO32                     |
| 风扇开关控制   | GPIO33                     |
| PWM 控制风扇 | GPIO18                     |
| OLED I2C | SDA/GPIO21, SCL/GPIO22（默认） |

---

## 软件功能模块

本项目已模块化组织：

| 模块             | 功能描述                |
|----------------|---------------------|
| `secrets.h`    | WiFi 和 MQTT 连接信息    |
| `config.h`     | 所有配置参数、引脚、阈值        |
| `network.*`    | WiFi 和 MQTT 管理      |
| `ble_mijia.*`  | 扫描并解析米家蓝牙温湿度数据      |
| `sensors.*`    | 读取三个 DS18B20 温度传感器  |
| `cooling.*`    | 控制 TEC 和风扇通断、PWM 输出 |
| `oled_ui.*`    | 图形化显示系统状态           |
| `web_server.*` | 提供本地 HTTP 接口用于查看状态  |
| `status.*`     | 所有跨模块状态变量统一管理       |
