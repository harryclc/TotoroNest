<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <title>TotoroNest æ§åˆ¶ä¸­å¿ƒ</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f7f7f7;
            padding: 1rem;
            max-width: 500px;
            margin: auto;
        }

        h2 {
            margin-top: 1.5rem;
            border-bottom: 1px solid #ccc;
            padding-bottom: 0.3rem;
        }

        section {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        label {
            margin: 0.3rem 0;
            display: block;
        }

        select, input {
            margin: 0.3rem 0;
            display: inline;
        }

        button {
            margin: 0.5rem 0.2rem;
            padding: 0.4rem 1rem;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin: 0.2rem 0;
        }

        .status-value {
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
<h1>TotoroNest æ§åˆ¶ä¸­å¿ƒ</h1>

<section id="status-panel">
    <h2>ğŸ“ˆ å½“å‰çŠ¶æ€</h2>
    <ul>
        <li>çªå†…æ¸©åº¦1: <span class="status-value" id="temp1">--</span> â„ƒ</li>
        <li>çªå†…æ¸©åº¦2: <span class="status-value" id="temp2">--</span> â„ƒ</li>
        <li>æ¸©æ§ç³»ç»Ÿæ¸©åº¦: <span class="status-value" id="temp3">--</span> â„ƒ</li>
        <li>ç¯å¢ƒæ¸©åº¦: <span class="status-value" id="ambient_temp">--</span> â„ƒ</li>
        <li>ç¯å¢ƒæ¹¿åº¦: <span class="status-value" id="ambient_humidity">--</span> %</li>
        <li>TECçŠ¶æ€: <span class="status-value" id="cooling">--</span></li>
        <li>é£æ‰‡PWM: <span class="status-value" id="pwm">--</span></li>
    </ul>
</section>

<section id="tec-control">
    <h2>ğŸ”Œ æ‰‹åŠ¨æ§åˆ¶ TEC</h2>
    <button onclick="toggleTEC(true)">å¼€å¯ TEC</button>
    <button onclick="toggleTEC(false)">å…³é—­ TEC</button>
</section>

<section id="ac-control">
    <h2>â„ï¸ ç©ºè°ƒæ§åˆ¶</h2>
    <label>ç›®æ ‡æ¸©åº¦ï¼š
        <input type="number" id="set-temp" min="16" max="30" value="26"/> â„ƒ
    </label>
    <label>æ¨¡å¼ï¼š
        <select id="ac-mode">
            <option value="cool">åˆ¶å†·</option>
            <option value="heat">åˆ¶çƒ­</option>
            <option value="fan">é€é£</option>
            <option value="dry">é™¤æ¹¿</option>
            <option value="auto">è‡ªåŠ¨</option>
            <option value="off">å…³é—­</option>
        </select>
    </label>
    <label>é£é€Ÿï¼š
        <select id="fan-speed">
            <option value="auto">è‡ªåŠ¨</option>
            <option value="low">ä½</option>
            <option value="medium">ä¸­</option>
            <option value="high">é«˜</option>
        </select>
    </label>
    <button onclick="sendACCommand()">å‘é€æ§åˆ¶</button>
</section>

<script>
    function refreshStatus() {
        fetch("/api/status")
            .then(res => res.json())
            .then(data => {
                document.getElementById("temp1").textContent = data.temp1?.toFixed(2) ?? "--";
                document.getElementById("temp2").textContent = data.temp2?.toFixed(2) ?? "--";
                document.getElementById("temp3").textContent = data.temp3?.toFixed(2) ?? "--";
                document.getElementById("ambient_temp").textContent = data.ambient_temp?.toFixed(2) ?? "--";
                document.getElementById("ambient_humidity").textContent = data.ambient_humidity ?? "--";
                document.getElementById("cooling").textContent = data.cooling ? "å¼€å¯" : "å…³é—­";
                document.getElementById("pwm").textContent = data.pwm ?? "--";
            }).catch(() => {
            document.getElementById("cooling").textContent = "è¿æ¥å¤±è´¥";
        });
    }

    function toggleTEC(state) {
        fetch("/api/tec_control", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({status: state})
        }).then(res => {
            if (res.ok) alert(state ? "TECå·²å¼€å¯" : "TECå·²å…³é—­");
            else alert("æ“ä½œå¤±è´¥");
        });
    }

    function sendACCommand() {
        const payload = {
            temperature: parseInt(document.getElementById("set-temp").value),
            mode: document.getElementById("ac-mode").value,
            fan: document.getElementById("fan-speed").value
        };
        fetch("/api/ir_control", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        }).then(res => {
            if (res.ok) alert("ç©ºè°ƒå‘½ä»¤å·²å‘é€");
            else alert("å‘é€å¤±è´¥");
        });
    }

    setInterval(refreshStatus, 5000);
    window.onload = refreshStatus;
</script>
</body>
</html>